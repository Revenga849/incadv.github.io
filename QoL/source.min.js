function checkHighlightPrestigeAndAutoBuyCustom(e=0){document.getElementById("top-menu-prestige-button").classList.contains("highlight")&&document.getElementById("top-menu-prestige-button").classList.remove("highlight");let t=!1;for(let a=e;a>=0;a--){if(void 0!==game.prestige&&void 0!==game.prestige[a]){let l=getAvailablePrestigePoints(),s=l[a].plus(game.prestige[a][0]).dividedBy(new Decimal(5)).floor();s.cmp(new Decimal("1e10"))>0&&(s=s.times(.99).floor());let u=!1;for(let d=1;d<=5;d++){var n=getPrestigePointsFromStatUpgrades(game.prestige[a][d]);if(s.plus(n).cmp(n.plus(1))>=0){let m=game.prestige[a][d],p=getStatUpgradesFromPrestigePoints(s.plus(n));if(p.cmp(getMultiBuyTarget(m,0))<0)continue;if(l[a].plus(game.prestige[a][0]).minus(getPrestigePointsFromStatUpgrades(p).minus(getPrestigePointsFromStatUpgrades(m))).cmp(0)<0)continue;if(0==getPrestigePointsFromStatUpgrades(p).minus(getPrestigePointsFromStatUpgrades(m)).cmp(0))continue;if(t||(autoPrestige(a),t=!0,addCombatLog(9,'<span style="font-weight: 600; color:#FF0000;">QoL</span> <span style="font-weight: 600;">Auto-Prestige Layer '+(a+1)+"</span>")),l[a]=new Decimal(0),game.prestige[a][0]=game.prestige[a][0].minus(getPrestigePointsFromStatUpgrades(p).minus(getPrestigePointsFromStatUpgrades(m))),game.prestige[a][d]=p,!u){var r=e+1,i=255-200*(r-a)/r;1==(i=Number.parseInt(i.toFixed(0)).toString(16)).length&&(i="0"+i);var o="#ff"+i+i;console.log(a+1+" of "+r+": "+o),addCombatLog(9,'<span style="fonr-weight: 600; color:'+o+';">QoL</span>'+' Auto-upgrade <span style="font-weight: 600;">Prestige Layer '+(a+1)+"</span>: ("+formatValue(m.plus(1).times(new Decimal(a>0?a:1)))+'x ><span style="font-weight: 600;"> '+formatValue(p.plus(1).times(new Decimal(a>0?a:1)))+"x</span>)"),u=!0}}}}availablePrestigePoints[a].cmp(0)>0&&canBuyAnyUpgradeForLayer(a)&&addHighlightToPrestigeButton()}void 0!==game.prestige&&(document.getElementById("top-menu-prestige-button").style.display="inline-block"),openBattleFieldScreen()}window.addEventListener("keydown",function(e){if("text"===document.activeElement.type||"number"===document.activeElement.type)return!1;e.keyCode;e.keyCode>=97&&e.keyCode<=104&&checkHighlightPrestigeAndAutoBuyCustom(e.keyCode-97)},!1),null!=(div=document.getElementById("layer-helper"))&&div.remove();var div,style=document.createElement("style");document.head.appendChild(style),style.sheet.insertRule(".enemy-damage { font-size: 1vw; }"),style.sheet.insertRule(".enemy-health { font-size: 1vw; }"),style.sheet.insertRule(".hero-damage { font-size: 1vw; }"),style.sheet.insertRule(".hero-health { font-size: 1vw; }"),style.sheet.insertRule(".hero-armor { font-size: 1vw; }"),style.sheet.insertRule(".hero-healing { font-size: 1vw; }"),document.getElementById("combat-log").setAttribute("style","width: 55vw; font-size: 1.25vw;"),(div=document.createElement("div")).setAttribute("id","layer-helper"),div.setAttribute("style","overflow:auto; height: 23vw; bottom: 0vw; right: 0; position: fixed; text-align: right;"),document.getElementById("battlefield-screen").append(div);var div2=document.createElement("div");div2.setAttribute("id","layer-totals"),div2.setAttribute("style","overflow:auto; bottom: 23vw; right: 0; position: fixed; text-align: right;");var totals=document.createElement("p");totals.setAttribute("id","p-totals"),totals.setAttribute("class","combat-log-record"),totals.setAttribute("style","display: block;");var span=document.createElement("span");span.setAttribute("id","l-totals"),span.innerHTML="<b>Total stat multi</b>: ",totals.append(span);var span2=document.createElement("span");function redraw(){var e=getAvailablePrestigePoints();if(e.length!=div.childElementCount-2){savePreferences(),div.innerHTML=null;var t=document.createElement("p");t.setAttribute("id","p-settingsFormat"),t.setAttribute("class","combat-log-record"),t.setAttribute("style","display: block; padding:4px;");var n=document.createElement("div");n.setAttribute("id","p-settings-format"),n.setAttribute("class","button prestige-menu-button"),n.setAttribute("style","padding-bottom: 1px;padding-top: 1px;padding-right: 10px;padding-left: 10px;margin-left: 5px;display: inline;"),n.innerText="Format: Default",n.setAttribute("onclick","toggleFormat();"),t.append(n);var r=document.createElement("div");r.setAttribute("id","p-settings-force-format"),r.setAttribute("class","button prestige-menu-button"),r.setAttribute("style","padding-bottom: 1px;padding-top: 1px;padding-right: 10px;padding-left: 10px;margin-left: 5px;display: inline;"),r.innerText="Force format OFF",r.setAttribute("title","Force selected format for all in-game numbers"),r.setAttribute("onclick","toggleForceFormat();"),t.append(r);var i=document.createElement("p");i.setAttribute("id","p-settingsCheat"),i.setAttribute("class","combat-log-record"),i.setAttribute("style","display: block; padding:4px;");var o=document.createElement("span");o.setAttribute("id","p-settings-constraint-button"),o.setAttribute("style","padding-bottom: 1px;padding-top: 1px;padding-right: 10px;padding-left: 10px;margin-left: 5px;display: none;"),o.setAttribute("title","Auto-prestige will not trigger if multi rate is growing at least "+formatValue(100*cosntraintValue-100)+"% per floor for layer 1, or per layer 1 prestige for other layers"),o.innerText="Prestige constraint: ",i.append(o);var a=document.createElement("input");a.setAttribute("id","p-settings-constraint-input"),a.setAttribute("type","text"),a.setAttribute("style","display: none; width: 3vw;"),a.setAttribute("title","Prestige constraint threshold"),a.value=formatValue(100*cosntraintValue-100)+"%",i.append(a);var l=document.createElement("div");l.setAttribute("id","p-settings-ap"),l.setAttribute("class","button prestige-menu-button"),l.setAttribute("style","padding-bottom: 1px;padding-top: 1px;padding-right: 10px;padding-left: 10px;margin-left: 5px;display: none;"),l.setAttribute("title","Auto-prestige if multi is higher than % of current stats or flat threshold. Percentage is applied to exponents for high numbers"),l.innerText="Auto inputs OFF",l.setAttribute("onclick","toggleAuto();"),i.append(l);var s=document.createElement("div");s.setAttribute("id","p-settings-cheat"),s.setAttribute("class","button prestige-menu-button"),s.setAttribute("style","padding-bottom: 1px;padding-top: 1px;padding-right: 10px;padding-left: 10px;margin-left: 5px;display: inline;"),s.setAttribute("title","These automating options include things not implemented in the game, so they are considered cheating. Use your conscience, you have been warned ;)"),s.innerText="Cheating OFF",s.setAttribute("onclick","toggleCheating();"),i.append(s),div.append(t),div.append(i);for(let t=0;t<e.length;t++){var u=document.createElement("p");u.setAttribute("id","p-l"+(t+1)),u.setAttribute("class","combat-log-record"),u.setAttribute("style","display: block");var d=document.createElement("span");d.setAttribute("id","l-"+(t+1)),d.innerHTML="<b>Layer "+(t+1)+"</b> stats: ",u.append(d);var m=document.createElement("span");m.setAttribute("id","l-"+(t+1)+"-stats"),m.style.display="inline-block",m.innerText=" ",u.append(m);var p=document.createElement("div");p.setAttribute("id","l"+(t+1)+"-button"),p.setAttribute("class","button prestige-menu-button"),p.setAttribute("style","text-align:center; padding-bottom: 1px;padding-top: 1px;padding-right: 2px;padding-left: 2px;margin: 0;margin-left: 5px;display: inline-block;"),p.setAttribute("onclick","checkHighlightPrestigeAndAutoBuyCustom("+t+");"),u.append(p);var c=document.createElement("input");c.setAttribute("type","checkbox"),c.setAttribute("id","cb-l"+t),c.setAttribute("value","AutoPrestige"),c.setAttribute("style","display:none; width: 1.5vw; height: 1em; vertical-align: middle;");var g=document.createElement("input");g.setAttribute("type","text"),g.setAttribute("id","ratio-l"+t),g.setAttribute("value","0"),g.setAttribute("style","display:none; width: 5vw;"),u.append(g),u.append(c),div.append(u)}var f=document.getElementById("ratio-l0");null!=f&&(f.value="6%");var h=document.getElementById("ratio-l1");null!=h&&(h.value="20%");var y=document.getElementById("ratio-l2");null!=y&&(y.value="60%");var b=document.getElementById("ratio-l3");null!=b&&(b.value="100%"),loadPreferences(),formatLines()}}span2.setAttribute("id","l-totals-stats"),span2.style.display="inline-block",span2.innerText=" ",totals.append(span2),div2.append(totals),document.getElementById("battlefield-screen").append(div2);var formats=["Default","Layered Exp","Logarithm","Force Exponential"],format=0,_renderNumber=renderNumber,formatValue=function(e){if(!(e instanceof Decimal))e=new Decimal(e);if(e<1e3)return Number.isInteger(e.mag)?e.toFixed(0):e.toFixed(2);var t=e.mantissa.toFixed(3),n=e.e;if(n>1e4)switch(formats[format]){case"Default":return _renderNumber(e);case"Layered Exp":return e.layer>=2?"e"+formatValue(e.log10()):"e"+formatValue(new Decimal(e.e));case"Logarithm":return"e".repeat(e.layer+1)+Math.log10(e.mag).toFixed(4)}return t+"e"+n},bShowAuto=!1;function toggleAuto(){bShowAuto=!bShowAuto,document.getElementById("p-settings-ap").innerText="Auto inputs "+(bShowAuto?"ON":"OFF"),document.querySelectorAll("[id^=cb],[id^=ratio]").forEach(e=>{e.style.display=bShowAuto?"inline":"none"})}var bConstraint=!0;function toggleConstraint(){bConstraint=!bConstraint,document.getElementById("p-settings-constraint-button").innerText="Prestige Constraint: ",document.getElementById("p-settings-constraint-input").style.display=bConstraint?"inline":"none"}function toggleFormat(){format=(format+1)%formats.length,document.getElementById("p-settings-format").innerText="Format: "+formats[format]}var forceFormat=!1;function toggleForceFormat(){forceFormat=!forceFormat,renderNumber=forceFormat?formatValue:_renderNumber,document.getElementById("p-settings-force-format").innerText="Force format: "+(forceFormat?"ON":"OFF")}var bCheating=!1;function toggleCheating(){bCheating=!bCheating,init=init||bCheating,bShowAuto=!bCheating,toggleAuto(),document.getElementById("p-settings-constraint-button").style.display=bCheating?"inline":"none",document.getElementById("p-settings-constraint-input").style.display=bCheating?"inline":"none",document.getElementById("p-settings-ap").style.display=bCheating?"inline":"none",document.querySelectorAll("[id^=cb]").forEach(e=>{e.checked=!1}),document.getElementById("p-settings-cheat").innerText="Cheating "+(bCheating?"ON":"OFF")}var preferences=[];function savePreferences(){(preferences=[]).showAuto=bShowAuto,preferences.constraint=bConstraint,preferences.format=format,preferences.ratios=Array.from(document.querySelectorAll("[id^=ratio]")).map(e=>e.value),preferences.checkboxes=Array.from(document.querySelectorAll("[id^=cb]")).map(e=>e.checked)}function loadPreferences(){0!=preferences.length&&(bShowAuto=preference.showAuto,bConstraint=preferences.constraint,format=preferences.format,document.querySelectorAll("[id^=ratio]").forEach((e,t)=>{e.value=preferences.ratios[t]}),document.querySelectorAll("[id^=cb]").forEach((e,t)=>{e.checked=preferences.checkboxes[t]}))}function formatLines(){document.querySelectorAll("[id^=l-][id$=stats]").forEach(e=>{e.style.width=""});var e=Math.max.apply(Math,Array.from(document.querySelectorAll("[id^=l-][id$=stats]")).map(e=>e.clientWidth))+1;document.querySelectorAll("[id^=l-][id$=stats]").forEach(t=>{t.style.width=e}),document.querySelectorAll("[id^=l][id$=button]").forEach(e=>{e.style.width=""});e=Math.max.apply(Math,Array.from(document.querySelectorAll("[id^=l][id$=button]")).map(e=>e.clientWidth))+1;document.querySelectorAll("[id^=l][id$=button]").forEach(t=>{t.style.width=e});var t=document.getElementById("battlefield-screen"),n=document.getElementById("combat-log"),r=document.getElementById("layer-helper");n.style.width=t.clientWidth-r.clientWidth-20}var prevmult=[],prevfloor=game.floor.mag,_prevfloor=game.floor.mag;function isDead(){return 0==game.heroes.filter(e=>e.currentHealth.cmp(0)>0).length}function floorChanged(){return 0!=prevfloor&&(_prevfloor=prevfloor),isDead()?(prevfloor=0,_prevfloor=1):prevfloor=_prevfloor,0!=prevfloor&&game.floor.mag>prevfloor}function checkAuto(e){var t=document.getElementById("cb-l"+e);return null!=t&&t.checked}var cosntraintValue=1.05;function checkConstraint(e,t,n){if(!bConstraint)return!0;if(prevmult[n].layer<=2&&prevmult[n].e<50)var r=prevmult[n].multiply(cosntraintValue);else r=prevmult[n].pow(cosntraintValue);return t.cmp(r)<0&&prevmult[n].cmp(1)>0&&t.cmp(1)>0}function checkMultiThreshold(e,t,n){var r=!1;e.mag,t.mag;if(null!=document.getElementById("cb-l"+n)){var i=document.getElementById("ratio-l"+n);if(null!=i){var o=i.value;if("0"!=o)if(o.includes("%")){var a=Number.parseInt(o)/100;if(e.layer<=2&&e.e<50)var l=e.multiply(a);else l=e.pow(a);tooltip="Auto at "+formatValue(l),t.cmp(l)>0&&(r=!0)}else{a=new Decimal(o);tooltip="Auto at "+formatValue(a),t.cmp(a)>0&&(r=!0)}}}return setButtonTitle(n,tooltip),r}function checkEnemiesDifficulty(){var e,t;game.heroes.length>0&&(e=game.heroes.map(e=>getHeroDamage(e)).reduce((e,t)=>e.cmp(t)>0?e:t));return game.enemies.length>0&&(t=game.enemies[0].maxHealth.multiply(2)),null!=e&&null!=t&&e.cmp(t)<0}function setButtonText(e,t){document.getElementById("l"+(e+1)+"-button").innerText="Prestige for "+t+"x"}function setButtonTitle(e,t){document.getElementById("l"+(e+1)+"-button").setAttribute("title",tooltip)}function setStatsText(e,t){document.getElementById("l-"+(e+1)+"-stats").innerText=t+"x"}function setTotalsText(e){document.getElementById("l-totals-stats").innerText=e+"x"}function setConstraintText(){var e=document.getElementById("p-settings-constraint-input");if(null!=e){var t=e.value;cosntraintValue=Number.parseInt(t)/100+1,document.getElementById("p-settings-constraint-button").setAttribute("title","By default, auto-prestige checks multipliers every floor change. If this is Enabled, auto-prestige will not trigger if multi rate is growing at least "+formatValue(100*cosntraintValue-100)+"% per floor for layer 1, or per layer 1 prestige for other layers")}getAvailablePrestigePoints()}function clearPrevMults(e){for(let t=e;t>=0;t--)prevmult[t]=new Decimal(1)}null!=sInterval&&clearInterval(sInterval);var init=!0,sInterval=setInterval(function(){setConstraintText(),redraw(),prestigePoints=getAvailablePrestigePoints();for(var e=[],t=[],n=0;n<prestigePoints.length;n++){if(null!=game.prestige)if(null!=game.prestige[n]){var r=game.prestige[n][1].plus(1).multiply(n>0?n:1),i=new Decimal(1),o=game.prestige[n][1];if(a=(a=getPrestigePointsFromStatUpgrades(o)).plus(prestigePoints[n].divideBy(5).floor()),getStatUpgradesFromPrestigePoints(a).cmp(getStatUpgradesFromPrestigePoints(o.add(1)))>=0)i=getStatUpgradesFromPrestigePoints(a).plus(1).divideBy(o.plus(1))}else{var a;r=new Decimal(1),i=new Decimal(0==n?1:n);(a=(a=new Decimal(0)).plus(prestigePoints[n].divideBy(5).floor())).cmp(0)>0&&(i=i.multiply(getStatUpgradesFromPrestigePoints(a).plus(1)))}else r=new Decimal(1);e[n]=r,setStatsText(n,formatValue(r)),t[n]=i,setButtonText(n,formatValue(i)),void 0!==game.prestige?setTotalsText(formatValue(game.prestige.reduce((e,t,n)=>e.multiply(t[1].add(1).multiply(n>0?n:1)),new Decimal(1)))):setTotalsText(1),init&&null==prevmult[n]&&(prevmult[n]=i)}init=!1;var l=floorChanged(),s=[];if(l){var u=checkEnemiesDifficulty();for(let n=0;n<prestigePoints.length;n++)null==prevmult[n]&&(prevmult[n]=new Decimal(1)),checkAuto(n)&&checkMultiThreshold(e[n],t[n],n)&&checkConstraint(e[n],t[n],n)?s[n]=!0:s[n]=!1;for(let e=0;e<prestigePoints.length;e++)if(0==e){if(!checkAuto(0)){s[0]=!1,prevmult[0]=t[0];continue}s[0]||u?(prevfloor=0,s[0]=!0,checkHighlightPrestigeAndAutoBuyCustom(0),clearPrevMults(0)):prevmult[0]=t[0]}else s[e]&&s[e-1]?(prevfloor=0,checkHighlightPrestigeAndAutoBuyCustom(e),clearPrevMults(e)):prevmult[e]=t[e]}l&&(prevfloor=game.floor.mag),formatLines()},200);